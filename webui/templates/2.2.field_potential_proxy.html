{% extends "2.field_potential.html" %}
{% block title %}Field Potential proxy{% endblock %}

{% block head %}
{{ super() }}
<style type="text/tailwindcss">
    .material-symbols-outlined {
        font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24
    }
    .upload-zone:hover {
        @apply border-primary bg-primary/5;
    }
</style>
{% endblock %}


<!-- Main content of the field potential proxy page -->
{% block content %}
<div class="px-4 md:px-8 lg:px-20 flex justify-center">
    <div class="layout-content-container flex flex-col max-w-[900px]">
        <div class="mb-10">
            <h1 class="text-3xl font-black leading-tight tracking-[-0.033em] mb-2">Field Potential Configuration: Proxy</h1>
            <p class="text-slate-500 dark:text-slate-400 text-base">Configure the parameters and upload data for direct proxy
                estimation.</p>
        </div>

        <!-- Form action -->
        <form class="flex flex-col gap-8" method="POST" enctype="multipart/form-data" action="{{ url_for('start_computation_redirect', computation_type='field_potential_proxy')}} ">
            
            <!-- Proxy method selection -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="flex flex-col gap-2">
                    <label class="text-sm font-bold">Proxy Method</label>
                    <select onchange="updateFormVisibility()" id="proxyMethod"
                        class="form-select w-full h-12 rounded-lg border-slate-300 dark:border-slate-700 dark:bg-slate-900 focus:ring-primary focus:border-primary">
                        <option value="FR">Firing Rate (FR): firing rate averaged over all neurons in the population</option>
                        <option value="AMPA">AMPA: sum of AMPA currents</option>
                        <option value="GABA">GABA: sum of GABA currents</option>
                        <option value="Vm">Vm: Sum of membrane potentials</option>
                        <option value="I">I: sum of synaptic currents</option>
                        <option value="I_abs">I abs: sum of their absolute values</option>
                        <option value="LRWS">LRWS: LFP reference weighted sum</option>
                        <option value="ERWS1">ERWS1: EEG reference weighted sum 1 (non-causal)</option>
                        <option value="ERWS2">ERWS2: EEG reference weighted sum 2 (non-causal)</option>
                    </select>
                </div>
                <div id="simulationStepContainer" class="flex flex-col gap-2">
                    <label class="text-sm font-bold">Simulation Step (ms)</label>
                    <input
                        class="form-input w-full h-12 rounded-lg border-slate-300 dark:border-slate-700 dark:bg-slate-900 focus:ring-primary focus:border-primary"
                        step="0.1" type="number" value="0.1" />
                </div>
                <div class="flex flex-col gap-2">
                    <label class="text-sm font-bold">Excitatory Only</label>
                    <select
                        class="form-select w-full h-12 rounded-lg border-slate-300 dark:border-slate-700 dark:bg-slate-900 focus:ring-primary focus:border-primary">
                        <option>Yes</option>
                        <option>No</option>
                        <option>Default</option>
                    </select>
                </div>
            </div>

            <!-- Data sources (if needed) -->
            <div class="space-y-4">
                <h3 class="text-lg font-bold border-b border-slate-200 dark:border-slate-800 pb-2">Data Sources</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div id="frUploadContainer" 
                        class="upload-zone border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl p-6 flex flex-col items-center justify-center gap-2 cursor-pointer transition-all bg-white dark:bg-slate-900/50">
                        <span class="material-symbols-outlined text-slate-400">upload_file</span>
                        <span class="text-xs font-bold uppercase tracking-wider text-slate-500">Firing Rate Data (FR)</span>
                        <p class="text-[10px] text-slate-400">Drag &amp; drop or click to upload CSV</p>
                    </div>
                    <div id="vmUploadContainer"
                        class="upload-zone border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl p-6 flex flex-col items-center justify-center gap-2 cursor-pointer transition-all bg-white dark:bg-slate-900/50">
                        <span class="material-symbols-outlined text-slate-400">upload_file</span>
                        <span class="text-xs font-bold uppercase tracking-wider text-slate-500">Membrane Potential (Vm)</span>
                        <p class="text-[10px] text-slate-400">Drag &amp; drop or click to upload CSV</p>
                    </div>
                    <div id="ampaUploadContainer" 
                        class="upload-zone border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl p-6 flex flex-col items-center justify-center gap-2 cursor-pointer transition-all bg-white dark:bg-slate-900/50">
                        <span class="material-symbols-outlined text-slate-400">upload_file</span>
                        <span class="text-xs font-bold uppercase tracking-wider text-slate-500">AMPA Currents Data</span>
                        <p class="text-[10px] text-slate-400">Drag &amp; drop or click to upload CSV</p>
                    </div>
                    <div id="gabaUploadContainer" 
                        class="upload-zone border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl p-6 flex flex-col items-center justify-center gap-2 cursor-pointer transition-all bg-white dark:bg-slate-900/50">
                        <span class="material-symbols-outlined text-slate-400">upload_file</span>
                        <span class="text-xs font-bold uppercase tracking-wider text-slate-500">GABA Currents Data</span>
                        <p class="text-[10px] text-slate-400">Drag &amp; drop or click to upload CSV</p>
                    </div>
                </div>
            </div>

            <!-- External background rate -->
            <div id="externalRateContainer" class="flex flex-col gap-4">
                <h3 class="text-lg font-bold border-b border-slate-200 dark:border-slate-800 pb-2">External Background Rate</h3>
                <div class="flex flex-col md:flex-row gap-4 items-end">
                    <div class="flex flex-col gap-2 flex-1 w-full">
                        <label class="text-sm font-bold">External Background Rate (nu_ext)</label>
                        <input
                            class="form-input w-full h-12 rounded-lg border-slate-300 dark:border-slate-700 dark:bg-slate-900 focus:ring-primary focus:border-primary"
                            placeholder="e.g., 2.5 or upload file" type="number" />
                    </div>
                    <div class="w-full md:w-auto">
                        <input class="hidden" type="file" accept=".csv" id="ext-back-rate"/>
                        <button
                            class="w-full h-12 px-6 border border-slate-300 dark:border-slate-700 rounded-lg flex items-center justify-center gap-2 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors"
                            type="button">
                            <span class="material-symbols-outlined text-xl">upload</span>
                            <span class="font-bold text-sm">Upload nu_ext</span>
                        </button>
                    </div>
                </div>
            </div>
            <div
                class="flex flex-col-reverse sm:flex-row items-center justify-between gap-4 mt-8 pt-8 border-t border-slate-200 dark:border-slate-800">
                <a href="{{url_for('field_potential')}}"
                    class="w-full sm:w-auto px-6 h-12 flex items-center justify-center gap-2 text-slate-600 dark:text-slate-300 font-bold hover:text-slate-900 dark:hover:text-white transition-colors"
                    type="button">
                    <span class="material-symbols-outlined">arrow_back</span>
                    Back to selection
                </a>
                <div class="flex w-full sm:w-auto gap-4">
                    <button
                        class="w-full sm:w-auto min-w-[160px] h-12 bg-primary text-background-dark font-black rounded-lg hover:shadow-lg hover:brightness-105 transition-all flex items-center justify-center gap-2"
                        type="submit">
                        <span class="material-symbols-outlined">calculate</span>
                        Compute
                    </button>
                </div>
            </div>
        </form>
        <div class="flex justify-start gap-4 p-4 mt-auto py-10">
            <a href="{{url_for('dashboard')}}" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-6 bg-transparent text-slate-500 dark:text-slate-400 text-sm font-bold leading-normal tracking-[0.015em] border border-slate-200 dark:border-slate-800 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
                <span class="truncate">Back to the dashboard</span>
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script defer="" src="{{ url_for('static', filename='js/field_potential_proxy.js') }}"></script>
{% endblock %}
