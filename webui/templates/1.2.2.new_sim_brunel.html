{% extends "base.html" %}
{% block title %}New simulation{% endblock %}

<!-- Main color for simulation page: yellow -->
{% block head %}
{{ super() }}
<script id="tailwind-config">
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    "primary": "#FAC638",
                    "background-light": "#f6f6f8",
                    "background-dark": "#101322",
                },
                fontFamily: {
                    "display": ["Space Grotesk"]
                },
                borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
            },
        },
    }
</script>
{% endblock %}


<!-- Main content of the simulation page -->
{% block content %}

<!-- Parameter template (hidden) -->
<template id="parameter-section">
    <section class="parameter-section">
        <section class="flex flex-col gap-6">
            <h2
                class="text-slate-900 dark:text-white text-xl font-bold leading-tight tracking-[-0.015em] px-4 pb-3 pt-5 border-b border-slate-200 dark:border-slate-800">
                Simulation parameters</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 px-4">
                <label class="flex flex-col gap-2">
                    <span class="text-slate-800 dark:text-white text-sm font-medium">Simulation time
                        tstop (ms)</span>
                    <input
                        class="param-input form-input rounded-lg border-slate-300 dark:border-slate-700 bg-background-light dark:bg-[#191e33] text-slate-900 dark:text-white"
                        type="number" step="any" data-param="tstop" />
                </label>
                <label class="flex flex-col gap-2">
                    <span class="text-slate-800 dark:text-white text-sm font-medium">Time step
                        dt (ms)</span>
                    <input
                        class="param-input form-input rounded-lg border-slate-300 dark:border-slate-700 bg-background-light dark:bg-[#191e33] text-slate-900 dark:text-white"
                        type="number" step="any" data-param="dt"/>
                </label>
                <label class="flex flex-col gap-2">
                    <span class="text-slate-800 dark:text-white text-sm font-medium">Threads
                        local_num_threads</span>
                    <input
                        class="param-input form-input rounded-lg border-slate-300 dark:border-slate-700 bg-background-light dark:bg-[#191e33] text-slate-900 dark:text-white"
                        type="number" min="1" step="1" data-param="local_num_threads" />
                </label>
            </div>
        </section>
        <section class="flex flex-col gap-6">
            <h2
                class="text-slate-900 dark:text-white text-xl font-bold leading-tight tracking-[-0.015em] px-4 pb-3 pt-5 border-b border-slate-200 dark:border-slate-800">
                Network</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 px-4">
                <label class="flex flex-col gap-2">
                    <span class="text-slate-800 dark:text-white text-sm font-medium">Populations
                        X</span>
                    <input
                        class="param-input form-input rounded-lg border-slate-300 dark:border-slate-700 bg-background-light dark:bg-[#191e33] text-slate-900 dark:text-white"
                        type="text" data-param="X"/>
                </label>
                <label class="flex flex-col gap-2">
                    <span class="text-slate-800 dark:text-white text-sm font-medium">Population
                        sizes N_X</span>
                    <input
                        class="param-input form-input rounded-lg border-slate-300 dark:border-slate-700 bg-background-light dark:bg-[#191e33] text-slate-900 dark:text-white"
                        type="text" data-param="N_X"/>
                </label>
                <label class="flex flex-col gap-2">
                    <span class="text-slate-800 dark:text-white text-sm font-medium">Membrane
                        capacitance C_m_X</span>
                    <input
                        class="param-input form-input rounded-lg border-slate-300 dark:border-slate-700 bg-background-light dark:bg-[#191e33] text-slate-900 dark:text-white"
                        type="text" data-param="C_m_X"/>
                </label>
                <label class="flex flex-col gap-2">
                    <span class="text-slate-800 dark:text-white text-sm font-medium">Membrane
                        time constant tau_m_X (ms)</span>
                    <input
                        class="param-input form-input rounded-lg border-slate-300 dark:border-slate-700 bg-background-light dark:bg-[#191e33] text-slate-900 dark:text-white"
                        type="text" data-param="tau_m_X"/>
                </label>
                <label class="flex flex-col gap-2">
                    <span class="text-slate-800 dark:text-white text-sm font-medium">Resting
                        potential E_L_X (mV)</span>
                    <input
                        class="param-input form-input rounded-lg border-slate-300 dark:border-slate-700 bg-background-light dark:bg-[#191e33] text-slate-900 dark:text-white"
                        type="text" data-param="E_L_X"/>
                </label>
                <label class="flex flex-col gap-2">
                    <span class="text-slate-800 dark:text-white text-sm font-medium">Neuron
                        model</span>
                    <input
                        class="param-input form-input rounded-lg border-slate-300 dark:border-slate-700 bg-background-light dark:bg-[#191e33] text-slate-900 dark:text-white"
                        type="text" data-param="model"/>
                </label>
            </div>
        </section>
        <section class="flex flex-col gap-6">
            <h2
                class="text-slate-900 dark:text-white text-xl font-bold leading-tight tracking-[-0.015em] px-4 pb-3 pt-5 border-b border-slate-200 dark:border-slate-800">
                Connectivity</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 px-4">
                <label class="flex flex-col gap-2">
                    <span class="text-slate-800 dark:text-white text-sm font-medium">Connection
                        probability matrix C_YX</span>
                    <input
                        class="param-input form-input rounded-lg border-slate-300 dark:border-slate-700 bg-background-light dark:bg-[#191e33] text-slate-900 dark:text-white"
                        type="text" data-param="C_YX"/>
                </label>
                <label class="flex flex-col gap-2">
                    <span class="text-slate-800 dark:text-white text-sm font-medium">Synaptic
                        weight matrix J_YX (pA)</span>
                    <input
                        class="param-input form-input rounded-lg border-slate-300 dark:border-slate-700 bg-background-light dark:bg-[#191e33] text-slate-900 dark:text-white"
                        type="text" data-param="J_YX"/>
                </label>
                <label class="flex flex-col gap-2">
                    <span class="text-slate-800 dark:text-white text-sm font-medium">Synaptic
                        delay matrix delay_YX (ms)</span>
                    <input
                        class="param-input form-input rounded-lg border-slate-300 dark:border-slate-700 bg-background-light dark:bg-[#191e33] text-slate-900 dark:text-white"
                        type="text" data-param="delay_YX"/>
                </label>
                <label class="flex flex-col gap-2">
                    <span class="text-slate-800 dark:text-white text-sm font-medium">Synaptic
                        time constants tau_syn_YX (ms)</span>
                    <input
                        class="param-input form-input rounded-lg border-slate-300 dark:border-slate-700 bg-background-light dark:bg-[#191e33] text-slate-900 dark:text-white"
                        type="text" data-param="tau_syn_YX"/>
                </label>
                <label class="flex flex-col gap-2">
                    <span class="text-slate-800 dark:text-white text-sm font-medium">External
                        indegree n_ext</span>
                    <input
                        class="param-input form-input rounded-lg border-slate-300 dark:border-slate-700 bg-background-light dark:bg-[#191e33] text-slate-900 dark:text-white"
                        type="text" data-param="n_ext"/>
                </label>
                <label class="flex flex-col gap-2">
                    <span class="text-slate-800 dark:text-white text-sm font-medium">External
                        rate nu_ext (Hz)</span>
                    <input
                        class="param-input form-input rounded-lg border-slate-300 dark:border-slate-700 bg-background-light dark:bg-[#191e33] text-slate-900 dark:text-white"
                        type="number" step="any" data-param="nu_ext"/>
                </label>
                <label class="flex flex-col gap-2">
                    <span class="text-slate-800 dark:text-white text-sm font-medium">External
                        weight J_ext (pA)</span>
                    <input
                        class="param-input form-input rounded-lg border-slate-300 dark:border-slate-700 bg-background-light dark:bg-[#191e33] text-slate-900 dark:text-white"
                        type="number" step="any" data-param="J_ext"/>
                </label>
            </div>
        </section>
    </section>
</template>


<form id="run-simulation-form" method="POST" action="{{ url_for('run_trial_simulation', model_type='hagen') }}">
    <section class="flex flex-col gap-4 px-4 pb-2">
        <h2 class="text-slate-900 dark:text-white text-xl font-bold leading-tight tracking-[-0.015em]">Simulation mode</h2>
        <div class="flex flex-col md:flex-row gap-4">
            <label class="flex items-center gap-2 text-slate-800 dark:text-white text-sm font-medium">
                <input type="radio" name="sim_run_mode" value="single" checked class="text-primary focus:ring-primary" />
                Single trial
            </label>
            <label class="flex items-center gap-2 text-slate-800 dark:text-white text-sm font-medium">
                <input type="radio" name="sim_run_mode" value="grid" class="text-primary focus:ring-primary" />
                Parameter grid search
            </label>
        </div>
    </section>

    <!-- Container where input parameters will be appended with their default values -->
    <div id="parameter-container">
    </div>

    <!-- Action buttons -->
    <div class="flex justify-between items-center gap-4 p-4 mt-6">
        <div class="flex justify-start gap-4 p-4 mt-6">
            <a
                href="{{url_for('dashboard')}}" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-6 bg-transparent text-slate-800 dark:text-white text-base font-bold leading-normal tracking-[0.015em] border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800">
                <span class="truncate">Back to the dashboard</span>
            </a>

            <a
                href="{{url_for('simulation')}}" class="flex items-center gap-2 h-12 px-6 rounded-lg bg-white dark:bg-slate-900 text-slate-800 dark:text-white text-sm font-bold border border-slate-300 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
                <span class="material-symbols-outlined text-lg">arrow_back</span>
                Back to simulation options
            </a>
        </div>
        <button type="submit"
            class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-6 bg-primary text-white text-base font-bold leading-normal tracking-[0.015em]">
            <span id="run-simulation-button-label" class="truncate">Run trial simulation</span>
        </button>
    </div>
</form>
</div>

{% endblock %}


{% block scripts %}
    {{ super() }} <!-- import base.html scripts -->

    <!-- Simulation-specific JavaScript -->
    <script src="{{ url_for('static', filename='js/simulation.js') }}"></script>

{% endblock %} > 
